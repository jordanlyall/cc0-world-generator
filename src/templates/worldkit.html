<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Worldkit Token</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #0d0d0d;
      --surface: #161616;
      --surface2: #1c1c1c;
      --border: #2a2a2a;
      --text: #e8e8e8;
      --muted: #666;
      --accent: #7c3aed;
      --green: #22c55e;
      --yellow: #eab308;
      --red: #ef4444;
      --mono: 'JetBrains Mono', 'Fira Code', 'Courier New', monospace;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      border-bottom: 1px solid var(--border);
      padding: 1.25rem 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo { font-family: var(--mono); font-size: 0.8rem; color: var(--muted); letter-spacing: 0.05em; }
    .logo span { color: var(--accent); }

    .breadcrumb {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      font-family: var(--mono);
      font-size: 0.75rem;
      color: var(--muted);
    }
    .breadcrumb a { color: var(--muted); text-decoration: none; }
    .breadcrumb a:hover { color: var(--text); }
    .breadcrumb-sep { color: var(--border); }
    .breadcrumb-current { color: var(--accent); }

    main {
      flex: 1;
      max-width: 820px;
      margin: 0 auto;
      padding: 3rem 2rem 4rem;
      width: 100%;
    }

    /* ── Token hero ── */
    .token-hero {
      display: flex;
      align-items: flex-start;
      gap: 2.5rem;
      margin-bottom: 3rem;
      flex-wrap: wrap;
    }

    .gen-count-block {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem 2rem;
      min-width: 140px;
      flex-shrink: 0;
    }

    .gen-count-number {
      font-family: var(--mono);
      font-size: 3.5rem;
      font-weight: 700;
      color: var(--accent);
      line-height: 1;
    }

    .gen-count-label {
      font-size: 0.7rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-top: 0.5rem;
    }

    .token-meta {
      flex: 1;
      min-width: 200px;
    }

    .token-id-row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.5rem;
    }

    .token-id {
      font-size: 2rem;
      font-weight: 700;
      letter-spacing: -0.02em;
    }

    .universe-badge {
      font-family: var(--mono);
      font-size: 0.72rem;
      background: #2a1a4a;
      color: #a78bfa;
      border: 1px solid #3d2a6e;
      padding: 0.25rem 0.6rem;
      border-radius: 5px;
      text-transform: lowercase;
    }

    .meta-row {
      display: flex;
      align-items: baseline;
      gap: 0.5rem;
      margin-bottom: 0.375rem;
    }

    .meta-label {
      font-size: 0.7rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.07em;
      flex-shrink: 0;
    }

    .meta-value {
      font-family: var(--mono);
      font-size: 0.75rem;
      color: var(--text);
      word-break: break-all;
    }

    .meta-value.muted { color: var(--muted); }

    /* ── Section title ── */
    .section-title {
      font-size: 0.72rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.09em;
      margin-bottom: 0.875rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .section-title::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border);
    }

    /* ── Generation list ── */
    .gen-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .gen-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1.25rem;
      position: relative;
    }

    .gen-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.875rem;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .gen-index {
      font-family: var(--mono);
      font-size: 0.75rem;
      color: var(--muted);
    }

    .gen-timestamp {
      font-family: var(--mono);
      font-size: 0.7rem;
      color: var(--muted);
    }

    .confidence-pill {
      font-family: var(--mono);
      font-size: 0.68rem;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
    }
    .conf-high { background: #14532d; color: var(--green); }
    .conf-medium { background: #422006; color: var(--yellow); }
    .conf-low { background: #450a0a; color: var(--red); }

    .gen-hash-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
    }

    @media (max-width: 600px) {
      .gen-hash-grid { grid-template-columns: 1fr; }
    }

    .hash-block {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 5px;
      padding: 0.5rem 0.75rem;
    }

    .hash-label {
      font-size: 0.62rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.07em;
      margin-bottom: 0.25rem;
    }

    .hash-value {
      font-family: var(--mono);
      font-size: 0.7rem;
      color: var(--text);
      word-break: break-all;
    }

    .hash-value.empty { color: #333; font-style: italic; }

    .gen-row {
      display: flex;
      align-items: baseline;
      gap: 0.5rem;
      margin-top: 0.375rem;
    }

    .gen-row-label {
      font-size: 0.67rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      flex-shrink: 0;
      width: 80px;
    }

    .gen-row-value {
      font-family: var(--mono);
      font-size: 0.72rem;
      color: var(--text);
      word-break: break-all;
    }

    .gen-row-value.muted { color: var(--muted); }

    .universe-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
    }

    .univ-chip {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 0.15rem 0.45rem;
      font-family: var(--mono);
      font-size: 0.67rem;
      color: var(--muted);
    }

    .ipfs-link {
      color: var(--accent);
      text-decoration: none;
      font-family: var(--mono);
      font-size: 0.72rem;
    }
    .ipfs-link:hover { text-decoration: underline; }

    /* ── Empty state ── */
    .empty-state {
      text-align: center;
      padding: 4rem 0;
      color: var(--muted);
    }

    .empty-state-icon {
      font-size: 2.5rem;
      margin-bottom: 1rem;
    }

    .empty-label {
      font-size: 0.875rem;
      line-height: 1.6;
    }

    /* ── Error state ── */
    .error-state {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 2rem;
      text-align: center;
    }

    .error-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--red);
      margin-bottom: 0.5rem;
    }

    .error-detail {
      font-family: var(--mono);
      font-size: 0.75rem;
      color: var(--muted);
    }

    /* ── About / explainer panel ── */
    .about-panel {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 2.5rem;
    }

    .about-panel p {
      font-size: 0.825rem;
      color: var(--muted);
      line-height: 1.65;
      margin-bottom: 0.75rem;
    }

    .about-panel p:last-child { margin-bottom: 0; }

    .about-panel strong { color: var(--text); font-weight: 600; }

    .about-toggle {
      background: none;
      border: none;
      color: var(--muted);
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.07em;
      cursor: pointer;
      padding: 0;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      margin-bottom: 2.5rem;
    }
    .about-toggle:hover { color: var(--text); }
    .about-toggle .chevron { font-size: 0.6rem; transition: transform 0.15s; }
    .about-toggle.open .chevron { transform: rotate(90deg); }

    /* ── Phase badge ── */
    .phase-badge {
      font-family: var(--mono);
      font-size: 0.68rem;
      background: #1a1a2e;
      color: #818cf8;
      border: 1px solid #2d2d5e;
      padding: 0.15rem 0.5rem;
      border-radius: 4px;
    }

    /* ── Block height chip ── */
    .block-chip {
      font-family: var(--mono);
      font-size: 0.68rem;
      color: #555;
      background: #111;
      border: 1px solid #222;
      padding: 0.15rem 0.45rem;
      border-radius: 4px;
    }

    /* ── Copy button ── */
    .copy-btn {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--muted);
      font-size: 0.75rem;
      padding: 0 0.25rem;
      line-height: 1;
      vertical-align: middle;
      transition: color 0.15s;
      flex-shrink: 0;
    }
    .copy-btn:hover { color: var(--text); }
    .copy-btn.copied { color: var(--green); }

    /* ── Latest world callout ── */
    .latest-world-callout {
      background: #110d1e;
      border: 1px solid #3b1f6b;
      border-radius: 8px;
      padding: 1.25rem 1.5rem;
      margin-bottom: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    .latest-world-label {
      font-family: var(--mono);
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #8b5cf6;
    }
    .latest-world-title {
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--text);
    }
    .latest-world-meta {
      font-size: 0.78rem;
      color: var(--muted);
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }

    footer {
      border-top: 1px solid var(--border);
      padding: 1.25rem 2rem;
      font-size: 0.75rem;
      color: var(--muted);
      display: flex;
      gap: 1rem;
    }
    footer a { color: var(--muted); text-decoration: none; }
    footer a:hover { color: var(--text); }
  </style>
</head>
<body>

<header>
  <div class="logo"><span>worldkit</span>.ai</div>
  <nav class="breadcrumb" id="breadcrumb" aria-label="breadcrumb">
    <a href="/">← Worldkit</a>
    <span class="breadcrumb-sep">/</span>
    <span class="breadcrumb-current" id="breadcrumb-token">...</span>
  </nav>
</header>

<main id="main">
  <p style="color: var(--muted); font-size: 0.875rem;">Loading token...</p>
</main>

<footer>
  <span>On-chain provenance. CC0 verified.</span>
  <a href="/">worldkit.ai</a>
</footer>

<script>
  const TOKEN = __TOKEN_JSON__;

  function t(str) {
    return document.createTextNode(str == null ? '' : String(str));
  }

  function el(tag, attrs, ...children) {
    const node = document.createElement(tag);
    if (attrs) {
      for (const [k, v] of Object.entries(attrs)) {
        if (k === 'class') node.className = v;
        else if (k === 'style') node.style.cssText = v;
        else node.setAttribute(k, v);
      }
    }
    for (const child of children) {
      if (child == null) continue;
      node.appendChild(typeof child === 'string' ? t(child) : child);
    }
    return node;
  }

  function truncate(hex, chars) {
    if (!hex || hex === '0x' + '0'.repeat(64)) return null;
    if (hex.length <= chars * 2 + 2) return hex;
    return hex.slice(0, chars + 2) + '…' + hex.slice(-chars);
  }

  function makeCopyBtn(text) {
    const btn = el('button', { class: 'copy-btn', title: 'Copy to clipboard' });
    btn.appendChild(t('⎘'));
    btn.addEventListener('click', () => {
      navigator.clipboard.writeText(text).then(() => {
        btn.classList.add('copied');
        btn.textContent = '✓';
        setTimeout(() => {
          btn.classList.remove('copied');
          btn.textContent = '⎘';
        }, 1500);
      });
    });
    return btn;
  }

  function confidenceClass(score) {
    if (score === null || score === undefined) return 'conf-low';
    const n = Number(score);
    if (n >= 80) return 'conf-high';
    if (n >= 50) return 'conf-medium';
    return 'conf-low';
  }

  function confidenceLabel(score) {
    if (score === null || score === undefined) return 'unknown';
    const n = Number(score);
    if (n >= 80) return 'high';
    if (n >= 50) return 'medium';
    return 'low';
  }

  function formatTimestamp(ts) {
    if (!ts) return null;
    const d = new Date(Number(ts) * 1000);
    return d.toLocaleString(undefined, { dateStyle: 'medium', timeStyle: 'short' });
  }

  function renderError(msg, detail) {
    const box = el('div', { class: 'error-state' });
    box.appendChild(el('div', { class: 'error-title' }, t(msg)));
    if (detail) box.appendChild(el('div', { class: 'error-detail' }, t(detail)));
    return box;
  }

  function renderToken(data) {
    if (data.error) {
      return renderError('Token not found', data.error);
    }

    const frag = document.createDocumentFragment();
    const genCount = data.generation_count || 0;
    const metadata = data.metadata || {};
    const generations = data.generations || [];

    // ── Hero: generation counter + token metadata ──
    const hero = el('div', { class: 'token-hero' });

    const countBlock = el('div', { class: 'gen-count-block' });
    countBlock.appendChild(el('div', { class: 'gen-count-number' }, t(genCount)));
    countBlock.appendChild(el('div', { class: 'gen-count-label' }, t('generations')));
    hero.appendChild(countBlock);

    const meta = el('div', { class: 'token-meta' });

    const idRow = el('div', { class: 'token-id-row' });
    idRow.appendChild(el('h1', { class: 'token-id' }, t('Worldkit #' + data.token_id)));
    if (metadata.universe) {
      idRow.appendChild(el('span', { class: 'universe-badge' }, t(metadata.universe)));
    }
    meta.appendChild(idRow);

    // Owner
    if (data.owner) {
      const row = el('div', { class: 'meta-row' });
      row.appendChild(el('span', { class: 'meta-label' }, t('Owner')));
      const ownerVal = el('span', { class: 'meta-value' });
      ownerVal.appendChild(t(data.owner.slice(0, 10) + '…' + data.owner.slice(-8)));
      ownerVal.appendChild(makeCopyBtn(data.owner));
      row.appendChild(ownerVal);
      meta.appendChild(row);
    }

    // TBA address
    if (data.tba_address) {
      const row = el('div', { class: 'meta-row' });
      row.appendChild(el('span', { class: 'meta-label' }, t('Agent Identity (TBA)')));
      const tbaVal = el('span', { class: 'meta-value' });
      tbaVal.appendChild(t(data.tba_address.slice(0, 10) + '…' + data.tba_address.slice(-8)));
      tbaVal.appendChild(makeCopyBtn(data.tba_address));
      row.appendChild(tbaVal);
      meta.appendChild(row);
    }

    // Mint timestamp
    if (data.minted_at) {
      const row = el('div', { class: 'meta-row' });
      row.appendChild(el('span', { class: 'meta-label' }, t('Minted at')));
      row.appendChild(el('span', { class: 'meta-value muted' },
        t(formatTimestamp(data.minted_at))));
      meta.appendChild(row);
    }

    // Phase
    if (data.current_phase != null) {
      const row = el('div', { class: 'meta-row' });
      row.appendChild(el('span', { class: 'meta-label' }, t('Phase')));
      const phaseLabels = { 1: 'Phase 1 — Open', 2: 'Phase 2 — Agents Only', 3: 'Phase 3 — Public' };
      row.appendChild(el('span', { class: 'phase-badge' },
        t(phaseLabels[data.current_phase] || 'Phase ' + data.current_phase)));
      meta.appendChild(row);
    }

    // Contract
    if (metadata.asset_source && metadata.asset_source.contract) {
      const contractAddr = metadata.asset_source.contract;
      const row = el('div', { class: 'meta-row' });
      row.appendChild(el('span', { class: 'meta-label' }, t('Contract')));
      const contractVal = el('span', { class: 'meta-value muted' });
      contractVal.appendChild(t(contractAddr.length > 20 ? contractAddr.slice(0, 10) + '…' + contractAddr.slice(-8) : contractAddr));
      contractVal.appendChild(makeCopyBtn(contractAddr));
      row.appendChild(contractVal);
      meta.appendChild(row);
    }

    // Total minted
    if (data.total_minted != null) {
      const row = el('div', { class: 'meta-row' });
      row.appendChild(el('span', { class: 'meta-label' }, t('Supply')));
      row.appendChild(el('span', { class: 'meta-value muted' },
        t(data.total_minted + ' / 4096 minted')));
      meta.appendChild(row);
    }

    hero.appendChild(meta);
    frag.appendChild(hero);

    // ── About this token (collapsible explainer) ──
    const toggleBtn = el('button', { class: 'about-toggle', id: 'about-toggle' });
    toggleBtn.appendChild(el('span', { class: 'chevron' }, t('▶')));
    toggleBtn.appendChild(t('What is a Worldkit token?'));
    frag.appendChild(toggleBtn);

    const aboutPanel = el('div', { class: 'about-panel', id: 'about-panel', style: 'display:none' });
    aboutPanel.appendChild(el('p', null,
      el('strong', null, t('Each Worldkit token is a unique on-chain identity for an AI agent.')),
      t(' Minting a token (WKIT) automatically creates a Token Bound Account (TBA) — a smart contract wallet that belongs to the NFT itself. Whoever holds the token controls the agent\'s identity and MCP access.')));
    aboutPanel.appendChild(el('p', null,
      el('strong', null, t('Generations are the agent\'s work history.')),
      t(' Every time a world is generated using this token, a generation record is written on-chain — capturing cryptographic hashes of the world bible and compliance manifest, the block height, and the CC0 universes drawn from. This makes every creative output auditable and provenance-verified.')));
    aboutPanel.appendChild(el('p', null,
      el('strong', null, t('Five locked CC0 universes form the corpus:')),
      t(' Nouns, CrypToadz, Mfers, Bulfinch\'s Mythology (1855), and racc00ns. All source material is CC0-licensed (public domain), meaning any world generated here carries zero IP risk for commercial use.')));
    aboutPanel.appendChild(el('p', null,
      el('strong', null, t('Token holders get free MCP access.')),
      t(' Non-holders pay per-call via x402. The token IS the access credential — no account, no API key, just on-chain proof of ownership.')));
    frag.appendChild(aboutPanel);

    toggleBtn.addEventListener('click', () => {
      const open = aboutPanel.style.display !== 'none';
      aboutPanel.style.display = open ? 'none' : 'block';
      toggleBtn.classList.toggle('open', !open);
    });

    // ── Generation history ──
    const sTitle = el('div', { class: 'section-title' }, t('Generation History'));
    frag.appendChild(sTitle);

    if (generations.length === 0) {
      const empty = el('div', { class: 'empty-state' });
      empty.appendChild(el('div', { class: 'empty-state-icon' }, t('◌')));
      const emptyText = el('p', { class: 'empty-label' });
      emptyText.appendChild(t('No worlds generated yet. '));
      const emptyLink = el('a', { href: '/' });
      emptyLink.appendChild(t('Use the generator →'));
      emptyText.appendChild(emptyLink);
      empty.appendChild(emptyText);
      frag.appendChild(empty);
      return frag;
    }

    // Latest world callout (most recent generation = last in array)
    const latest = generations[generations.length - 1];
    if (latest) {
      const callout = el('div', { class: 'latest-world-callout' });
      const calloutLabel = el('div', { class: 'latest-world-label' });
      calloutLabel.appendChild(t('Latest World'));
      callout.appendChild(calloutLabel);

      const calloutTitle = el('div', { class: 'latest-world-title' });
      calloutTitle.appendChild(t(latest.world_id || ('World #' + (generations.length))));
      callout.appendChild(calloutTitle);

      const calloutMeta = el('div', { class: 'latest-world-meta' });
      if (latest.universes_used && latest.universes_used.length > 0) {
        calloutMeta.appendChild(t(latest.universes_used.join(', ')));
      }
      if (latest.commercial_confidence != null) {
        const cls = confidenceClass(latest.commercial_confidence);
        calloutMeta.appendChild(el('span', { class: 'confidence-pill ' + cls },
          t(confidenceLabel(latest.commercial_confidence) + ' conf')));
      }
      callout.appendChild(calloutMeta);
      frag.appendChild(callout);
    }

    const list = el('div', { class: 'gen-list' });

    for (let i = generations.length - 1; i >= 0; i--) {
      const g = generations[i];
      const card = el('div', { class: 'gen-card' });

      // Card header: index, confidence, timestamp
      const hdr = el('div', { class: 'gen-card-header' });
      hdr.appendChild(el('span', { class: 'gen-index' }, t('gen.' + (i + 1))));

      const rightChips = el('div', { style: 'display:flex;align-items:center;gap:0.5rem;flex-wrap:wrap;' });
      if (g.commercial_confidence != null) {
        const cls = confidenceClass(g.commercial_confidence);
        rightChips.appendChild(
          el('span', { class: 'confidence-pill ' + cls },
            t(confidenceLabel(g.commercial_confidence) + ' conf · ' + g.commercial_confidence + '%'))
        );
      }
      if (g.block_height) {
        rightChips.appendChild(el('span', { class: 'block-chip' }, t('block ' + g.block_height)));
      }
      hdr.appendChild(rightChips);

      if (g.timestamp) {
        hdr.appendChild(el('span', { class: 'gen-timestamp' }, t(formatTimestamp(g.timestamp))));
      }
      card.appendChild(hdr);

      // Hashes
      const hashGrid = el('div', { class: 'gen-hash-grid' });

      const wbHash = el('div', { class: 'hash-block' });
      wbHash.appendChild(el('div', { class: 'hash-label' }, t('World Bible Hash')));
      const wbVal = g.world_bible_hash && g.world_bible_hash !== '0x' + '0'.repeat(64)
        ? truncate(g.world_bible_hash, 8)
        : null;
      wbHash.appendChild(el('div', { class: 'hash-value' + (wbVal ? '' : ' empty') },
        t(wbVal || 'not set')));
      if (wbVal) wbHash.appendChild(makeCopyBtn(g.world_bible_hash));
      hashGrid.appendChild(wbHash);

      const mHash = el('div', { class: 'hash-block' });
      mHash.appendChild(el('div', { class: 'hash-label' }, t('Manifest Hash')));
      const mVal = g.manifest_hash && g.manifest_hash !== '0x' + '0'.repeat(64)
        ? truncate(g.manifest_hash, 8)
        : null;
      mHash.appendChild(el('div', { class: 'hash-value' + (mVal ? '' : ' empty') },
        t(mVal || 'not set')));
      if (mVal) mHash.appendChild(makeCopyBtn(g.manifest_hash));
      hashGrid.appendChild(mHash);

      card.appendChild(hashGrid);

      // IPFS CID
      if (g.ipfs_cid) {
        const row = el('div', { class: 'gen-row' });
        row.appendChild(el('span', { class: 'gen-row-label' }, t('IPFS')));
        const link = el('a', { class: 'ipfs-link', href: 'https://ipfs.io/ipfs/' + g.ipfs_cid, target: '_blank', rel: 'noopener' },
          t(g.ipfs_cid.slice(0, 20) + '…'));
        row.appendChild(link);
        card.appendChild(row);
      }

      // Universes used
      if (g.universes_used && g.universes_used.length > 0) {
        const row = el('div', { class: 'gen-row' });
        row.appendChild(el('span', { class: 'gen-row-label' }, t('Universes')));
        const chips = el('div', { class: 'universe-chips' });
        for (const u of g.universes_used) {
          chips.appendChild(el('span', { class: 'univ-chip' }, t(u)));
        }
        row.appendChild(chips);
        card.appendChild(row);
      }

      // Generator address
      if (g.generator_address && g.generator_address !== '0x' + '0'.repeat(40)) {
        const row = el('div', { class: 'gen-row' });
        row.appendChild(el('span', { class: 'gen-row-label' }, t('Generator')));
        const genAddrSpan = el('span', { class: 'gen-row-value muted' });
        genAddrSpan.appendChild(t(g.generator_address.slice(0, 10) + '…' + g.generator_address.slice(-8)));
        genAddrSpan.appendChild(makeCopyBtn(g.generator_address));
        row.appendChild(genAddrSpan);
        card.appendChild(row);
      }

      list.appendChild(card);
    }

    frag.appendChild(list);
    return frag;
  }

  const main = document.getElementById('main');
  main.textContent = '';

  if (TOKEN) {
    document.title = 'Worldkit #' + TOKEN.token_id;
    const breadcrumbToken = document.getElementById('breadcrumb-token');
    if (breadcrumbToken) breadcrumbToken.textContent = 'manifest:' + String(TOKEN.token_id).padStart(4, '0');
    main.appendChild(renderToken(TOKEN));
  } else {
    main.appendChild(renderError('No token data', 'TOKEN injection failed.'));
  }
</script>
</body>
</html>
